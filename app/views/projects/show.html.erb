<script type="text/javascript">
    //<![CDATA[
    $(document).ready(function() {
      /* Activating Best In Place */
      $(".best_in_place").best_in_place();
      $(".best_in_place").live("click", function(){
      	$('input[type="submit"]').addClass('btn btn-mini btn-primary').css('margin-right','3px').css('margin-bottom','9px');
	  });

	  $('.best_in_place').bind("ajax:success", function(){
	  	$('#loading').show();
	  	document.location.reload(true);
	  });

    });
    //]]>
</script>

<style type="text/css">
.rotate {
	/* Safari */
	-webkit-transform: rotate(-90deg);
	/* Firefox */
	-moz-transform: rotate(-90deg);
	/* Internet Explorer */
	filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);

	font: bold 10px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;
	color: #4f6b72;
	letter-spacing: 2px;
	text-transform: uppercase;
	text-align: left;
	background: #E6EAE9;	
}

body {
	color: #4f6b72;
	background: #E6EAE9;
}

a {
	color: #c75f3e;
}

#mytable {
	width: 700px;
	padding: 0;
	margin: 0;
}

caption {
	padding: 0 0 5px 250px;
	font: italic 11px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;
	text-align: left;
}

th {
	font: bold 10px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;
	color: #4f6b72;
	border-right: 1px solid #C1DAD7;
	border-bottom: 1px solid #C1DAD7;
	border-top: 1px solid #C1DAD7;
	letter-spacing: 1px;
	text-transform: uppercase;
	text-align: left;
	padding: 6px 6px 6px 12px;
	background: #CAE8EA url(../bg_header.jpg) no-repeat;
	max-width: 10px;
}

th.entidade {
	text-align: center;
}

th.nobg {
	border-top: 1px solid #C1DAD7;
	border-left: 1px solid #C1DAD7;
	border-right: 1px solid #C1DAD7;
}

td {
	border-right: 1px solid #C1DAD7;
	border-bottom: 1px solid #C1DAD7;
	background: #fff;
	color: #4f6b72;
	text-transform: uppercase;
	text-align: center;
	font: bold 10px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;
	width: 0.5px;
	max-width: 0.5px;
}

td.alt {
	background: #F5FAFA;
	color: #797268;
}

th.spec {
	border-left: 1px solid #C1DAD7;
	border-top: 0;
	background: #fff url(../bullet1.gif) no-repeat;
	font: bold 10px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;
}

th.specalt {
	border-left: 1px solid #C1DAD7;
	border-top: 0;
	background: #f5fafa url(../bullet2.gif) no-repeat;
	font: bold 10px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;
	color: #797268;
}

.best_in_place {
	padding: .1m;
	cursor: hand;
	cursor: pointer;
	-moz-transition: background 0.5s linear;
	-o-transition: background 0.5s linear;
	-webkit-transition: background 0.5s linear;
	-moz-border-radius: 5px;
	-webkit-border-radius: 5px;
	-o-border-radius: 5px;
	-ms-border-radius: 5px;
	-khtml-border-radius: 5px;
	border-radius: 5px;
	text-transform: uppercase;
}

.best_in_place:hover {
  	background-color: #CCC;
}

.purr {
	position: fixed;
	width: 324px;
	top: 50px;
	right: 15px;
	padding: 20px;
	background-color: #333;
	color: #FFFFFF;
	border: 2px solid #FFFFFF;
}
.purr:hover .close	{
	position: absolute;
	top: 5px;
	right: 3px;
	display: block;
	width: 25px;
	height: 25px;
	text-indent: -9999px;
}

input[name="crud"] {
	width: 50px;  
	height: 12px;  
	margin-right: 5px;
	text-transform: uppercase;
}

</style>

<br><br><br><br><br><br>
<caption>Entidades Informacionais</caption>
<p id="notice"><%= notice %></p>

<table id="mytable" cellspacing="0" summary="Matrix">

  <tr>
  	<tr>
    	<th scope="col" abbr="Funcionalidades" class="nobg">Funcionalidades</th>
    	<% @entidades.each do |entidade| -%>
    		<td class="rotate" scope="col" abbr=<%= entidade.name %> >
    			<div style="margin-left:5px;"><%= entidade.name %></div>
    		</td>
		<% end -%>
		<th class="entidade" scope="col" abbr="Totais" >TOTAL</th>
  	</tr>  
  </tr>

  <% total_colunas =Hash.new %>
  <% total_linhas =Hash.new %>

  <% soma_total ="" %>

  <% @cases.each_with_index do |cdu,i| -%>
  	
  	<% total_linha='' %>	
  	<% cor = i.modulo(2)==0 ? "spec" : "specalt" %>
  	<% alt = i.modulo(2)==0 ? "" : "alt" %>

  	<tr>
	    <th scope="row" abbr=<%= cdu.name %> class=<%=cor%> ><%= cdu.name %></th>

	    	<% @entidades.each_with_index do |entidade,j| -%>

	    		<% caseTabela=matrix_crud(cdu.id,entidade.id) %>

			    <td class=<%=alt%>>

			    	<% caseTabela=CaseTabela.new(:crud=>'') if caseTabela.blank? %>

			    	<%= best_in_place caseTabela, :crud, :type => :input,:nil =>'--' , 
			    		:path => project_path(:case_id => cdu.id, :tabela_id => entidade.id,
			    		:lock_version =>caseTabela.lock_version ),:ok_button => 'OK' unless caseTabela.blank? %>	

			    	<% total_linha.concat(caseTabela.crud.to_s) unless caseTabela.blank? %>	
			    	
			    	<% total_colunas[entidade.name]= total_colunas[entidade.name].concat(caseTabela.crud) unless total_colunas[entidade.name].blank? %>
					
					<% total_colunas[entidade.name]= caseTabela.crud if total_colunas[entidade.name].blank? %>

			    </td>
			<% end -%>
			<td class=<%=alt%>>
				<%=render :partial => 'crud', :locals =>{:total_cases => total_linha} %>
			</td>
  	</tr>
  	<% total_linhas[cdu.name] =total_linha %>
  	<% soma_total.concat(total_linha) unless total_linha.blank? %>	
  <% end -%>
  <tfoot>
    <tr>
    	<td>TOTAL</td>
    	<% total_colunas.each_with_index do |total_colunas,index| -%>
	  		<td>
	  			<%=render :partial => 'crud', :locals =>{:total_cases => total_colunas} %>
			</td>
		<% end -%>
      	<td>
      		<%=render :partial => 'crud', :locals =>{:total_cases => soma_total} %>
      	</tb>
    </tr>
  </tfoot>
</table>

<%= total_linhas %>
<%= total_colunas %>

<h6><%= link_to "CRUD?", "http://pt.wikipedia.org/wiki/Matriz_de_intera%C3%A7%C3%B5es" %></h6>
<br>

<%= link_to 'Edit', edit_project_path(@project) %> |
<%= link_to 'Back', projects_path %>

